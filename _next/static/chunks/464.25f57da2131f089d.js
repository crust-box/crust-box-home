"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{2464:function(e,t,a){a.r(t),a.d(t,{default:function(){return Y}});var n=a(6453),l={baseUrl:"https://api.crustbox.decoo.io",gateways:[{up:"https://gw.crustfiles.net",down:"https://crustipfs.tech"},{up:"https://gw.smallwolf.me"},{up:"https://crust.fans"},{up:"https://crustgateway.com"},{up:"https://crustgateway.online"}]},s=a(2117),r=a(122),o=a.n(r);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return null==e?t:o()(e).format({output:"byte",base:"binary",mantissa:2,spaceSeparated:!1,...a}).replace("i","")}function c(e){if(!e)return"Unkown Error";if("string"==typeof e)return e;if(e instanceof s.d7){var t,a,n,l;return(null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.msg)||(null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||e.message||"Unkown Error"}return e.message||"Unkown Error"}var d=a(5092);let u=()=>{let e=function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];try{return e(...a)}catch(e){return}}(()=>JSON.parse(localStorage.getItem("logined")));if(e)return e},m=(0,d.Ue)(e=>({logined:u(),setLogined:t=>{localStorage.setItem("logined",JSON.stringify(t)),e({logined:t})}}));function p(e){let t=l.gateways.find(t=>{var a;return t.up===(null===(a=e.meta)||void 0===a?void 0:a.gateway)}),a=void 0!==(null==t?void 0:t.down)?"string"==typeof t.down?t.down:t.down[0]:void 0;return"".concat(a||"https://ipfs.io","/ipfs/").concat(e.cid)}var x=a(4875),h=a.n(x),f=a(959),g=a(7087);function v(e){let{...t}=e;return(0,n.jsx)("input",{maxLength:32,className:"input input-bordered w-full max-w-md",type:"text",...t})}function w(e){let{lable:t,...a}=e;return(0,n.jsxs)("div",{className:"w-full flex flex-col gap-2.5 text-base",children:[(0,n.jsxs)("div",{children:[t,":"]}),(0,n.jsx)(v,{...a})]})}function j(e){let{lable:t,value:a}=e;return(0,n.jsxs)("div",{className:"w-full flex flex-col gap-2.5 text-base",children:[(0,n.jsxs)("div",{className:"text-black",children:[t,":"]}),(0,n.jsx)("div",{className:"text-stone-500 break-words",children:a})]})}var b=a(3669),N=a(1191);let y=N.ZP,C=b.default.create({withCredentials:!0,baseURL:l.baseUrl});function k(){let e=m.getState().logined;return e?{headers:{Authorization:"Bearer ".concat(e.signature)}}:{}}function S(e){let t=e.data;if(!t||200!==t.code)throw t.message;return t.data}async function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await C.get(e,{...k(),params:t});return S(a)}async function z(e,t){let a=await C.post("/common/login",{username:e,password:t});return S(a)}async function _(e,t,a,n){await C.post("/psa/pins",{cid:e,name:t,size:a.toFixed(0),meta:n},k())}async function U(e){await C.post("/auth/".concat(e,"/delete"),{},k())}var F=a(3022);function E(){let[e,t]=(0,f.useState)(""),[a,l]=(0,f.useState)(""),s=!!e&&e.length>=4&&e.length<=32,r=!!a&&a.length>=6&&a.length<=16,o=!s||!r,{setLogined:i}=m();return(0,n.jsxs)("div",{className:"max-w-sm w-full flex flex-col gap-5 items-center p-5 mt-[20vmin]",children:[(0,n.jsx)(g.WCB,{className:"text-9xl mb-2.5"}),(0,n.jsx)(v,{maxLength:32,value:e,onChange:e=>t(e.target.value),placeholder:"商家账户"}),(0,n.jsx)(v,{maxLength:16,value:a,type:"password",onChange:e=>l(e.target.value)}),(0,n.jsx)("button",{className:"btn btn-primary w-full max-w-md",disabled:o,onClick:()=>{o||(0,F.qe)(()=>z(e,a)).then(e=>i(e)).catch(console.error)},children:"登录"})]})}var P=a(7563),T=a(6857),R=a(1875),Z=a(876);function A(e){let{className:t,as:a="div",text:n,start:l=10,end:s=10}=e;return f.createElement(a,{className:t,...n&&n.length>l+s?{"data-tooltip-id":"tooltip","data-tooltip-content":n}:{}},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return e?e.length<=a+n?e:e.substring(0,a)+"..."+e.substring(e.length-n):t}(n,"-",l,s))}var D=a(3289);function q(e){var t;let{file:a,onClose:l}=e,[,s]=(0,P.Z)();return(0,n.jsxs)(D.u_,{title:"文件上传",modalClassName:"w-[30rem]",outClose:!0,onClose:l,children:[(0,n.jsxs)("div",{className:"w-full flex flex-col px-5 gap-5 max-h-mc overflow-y-auto",children:[(0,n.jsx)(j,{lable:"报告号码",value:(null===(t=a.meta)||void 0===t?void 0:t.reportCode)||""}),(0,n.jsx)(j,{lable:"下载链接",value:p(a)})]}),(0,n.jsx)("div",{className:"w-full px-5 mt-5",children:(0,n.jsx)("button",{className:"btn btn-primary w-full",onClick:()=>{var e;let t="\n            报告号码:\n            ".concat(null===(e=a.meta)||void 0===e?void 0:e.reportCode,"\n\n            下载链接:\n            ").concat(p(a),"\n            ");s(t)},children:"复制信息"})})]})}function H(e){let t=(e,t)=>{let a=[];if(t){for(let n=e;n<t;n++)a.push(n);return a}for(let t=0;t<e;t++)a.push(t);return a},{total:a,pgSize:l,pgNum:s,onPageChange:r,className:o}=e,i=Math.ceil(a/l),c=(0,f.useMemo)(()=>i<=1?[]:i<=6?t(i).map(e=>({name:"".concat(e+1)})):s<=3?t(s+1).map(e=>({name:"".concat(e+1)})).concat([{name:"..."},{name:""+i}]):s>=i-2?[{name:"1"},{name:"..."}].concat(t(s-2,i).map(e=>({name:"".concat(e+1)}))):[{name:"1"},{name:"..."},{name:s-1+""},{name:s+""},{name:s+1+""},{name:"..."},{name:i+""}],[i,s]);return a<=l?null:(0,n.jsx)("div",{className:h()("flex justify-center text-[0.8125rem] text-center leading-8 font-semibold",o),children:(0,n.jsxs)("div",{className:"flex",children:[i>1&&(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("span",{onClick:()=>{r&&r(1,i)},className:"mx-[0.185rem] bg-white flex justify-center items-center cursor-pointer border min-w-[32px] h-[32px] rounded-lg",children:(0,n.jsx)(R.JHF,{})}),(0,n.jsx)("span",{onClick:()=>{r&&s>1&&r(s-1,i)},className:"mx-[0.185rem] bg-white flex justify-center items-center cursor-pointer border min-w-[32px] h-[32px] rounded-lg",children:(0,n.jsx)(R.YFh,{})})]}),c.map((e,t)=>(0,n.jsx)("div",{className:h()(e.name===""+s?"text-white bg-primary":"bg-white",{omit:"..."===e.name},"mx-[0.185rem] flex items-center justify-center min-w-[32px] h-[32px] px-1.5 rounded-lg","..."!=e.name&&"border cursor-pointer"),onClick:()=>{r&&"..."!==e.name&&r(+e.name,i)},children:e.name},"key_page_".concat(t))),i>1&&(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("span",{onClick:()=>{r&&s<i&&r(s+1,i)},className:"mx-[0.185rem] bg-white flex justify-center items-center cursor-pointer border min-w-[32px] h-[32px] rounded-lg",children:(0,n.jsx)(R.Tfp,{})}),(0,n.jsx)("span",{onClick:()=>{r&&r(i)},className:" mx-[0.185rem] bg-white flex justify-center items-center cursor-pointer border min-w-[32px] h-[32px] rounded-lg",children:(0,n.jsx)(R.qhs,{})})]})]})})}var I=a(8947);async function J(e,t,a){let n,s=0,r=async function(n){let l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e3;setTimeout(()=>{l&&0!==l.bytes||t.abort()},r);let o=new FormData;o.append("file",e);let i=await b.default.post("".concat(n.up,"/api/v0/add?pin=true"),o,{...k(),onUploadProgress(e){l=e;let t=e.total?e.loaded/e.total:0;console.info("progress:",s=Math.max(t,s)),a(s)},signal:t.signal});return{...i.data,gateway:n.up}};for(let e of l.gateways)try{let t=await r(e);return t}catch(e){n=e}throw n}function M(e){let{file:t,onClose:a,onSuccess:l}=e,[s,r]=(0,I.Z)({reportCode:"",sampleType:"",customerCode:"",clinicCode:""}),{reportCode:o,sampleType:i,customerCode:d,clinicCode:u}=s,{upFile:m,abort:p,loading:x,progress:h}=function(){let e=(0,T.p)(),[t,a]=(0,f.useState)(0),[n,l]=(0,f.useState)(!1),s=(0,f.useRef)(new AbortController),r=async(t,r)=>{if(n)return!1;l(!0),a(0);try{let e=await J(t,s.current,a);return r.gateway=e.gateway,await _(e.Hash,e.Name,t.size,r),!0}catch(t){return e.show({type:"error",msg:c(t)}),!1}finally{l(!1),a(0)}};return{progress:t,loading:n,abort:s,upFile:r}}();return(0,n.jsxs)(D.u_,{title:"文件上传",modalClassName:"w-[30rem]",onClose:()=>{var e;a&&a(),null===(e=p.current)||void 0===e||e.abort()},children:[(0,n.jsxs)("div",{className:"w-full flex flex-col px-5 gap-5 max-h-mc overflow-y-auto",children:[(0,n.jsx)(w,{lable:"报告号码",maxLength:64,value:o,onChange:e=>r({reportCode:e.target.value})}),(0,n.jsx)(w,{lable:"样本种类",maxLength:32,value:i,onChange:e=>r({sampleType:e.target.value})}),(0,n.jsx)(w,{lable:"客户编码",maxLength:64,value:d,onChange:e=>r({customerCode:e.target.value})}),(0,n.jsx)(w,{lable:"诊所编码",maxLength:32,value:u,onChange:e=>r({clinicCode:e.target.value})})]}),(0,n.jsx)("div",{className:"w-full px-5 mt-5",children:x?(0,n.jsx)("div",{className:"w-full py-5",children:(0,n.jsx)("progress",{className:"progress progress-success w-full",max:1,value:h})}):(0,n.jsx)("button",{className:"btn btn-primary w-full",disabled:!o||!i||!d||!u,onClick:()=>{m(t,s).then(e=>{e&&l()})},children:"确认上传"})})]})}let O=["文件名","CID","文件大小","上传时间","报告号码","样本种类","客户编号","诊所编码","操作"];function W(e){if(e&&1===e.length&&e[0].name.endsWith(".pdf"))return e[0]}function B(){let{data:e}=y("/auth/user/profile",L),[t,a]=(0,f.useState)(1),{data:l,mutate:s,isLoading:r}=y("/auth/file/list/size",L),{data:d,mutate:u,isLoading:m}=y("/auth/file/list?pageSize=".concat(9,"&pageNum=").concat(t),L),x=()=>{s(),u(),a(1)},g=function(){let[,e]=(0,P.Z)(),t=(0,T.p)();return a=>{e(a),t.show({type:"success",msg:"已复制"})}}(),v=(0,f.useRef)(null),[w,j]=(0,f.useState)(),b=(0,T.p)(),[N,C]=(0,f.useState)(),[k,{over:S}]=(0,Z.Z)({onFiles(e){let t=W(e);t?j(t):b.show({type:"warning",msg:"请选择单个PDF文件。"})}}),z=(0,f.useRef)(!1),_=e=>{z.current||(z.current=!0,(0,F.qe)(()=>U(e)).then(x).catch(e=>b.show({type:"error",msg:c(e)})).finally(()=>{z.current=!1}))};return(0,n.jsxs)("div",{...k,className:h()("flex-1 w-full border-dashed border-[4px] border-spacing-3",{"border-primary":S,"border-transparent":!S}),children:[r||m?(0,n.jsx)(F.gb,{}):(0,n.jsxs)("div",{className:"h-full flex flex-col w-full mx-auto gap-5 max-w-[1440px] items-center py-8 px-[3.75rem]",children:[(0,n.jsxs)("div",{className:"flex w-full items-center gap-8 ",children:[(0,n.jsx)("input",{ref:v,className:"hidden",type:"file",accept:".pdf",onChange:e=>{let t=W(e.target.files);t?j(t):b.show({type:"warning",msg:"请选择单个PDF文件。"})}}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},children:"+ 拖拽文件或点击上传"}),(0,n.jsxs)("span",{className:"text-lg",children:["文件: ",function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return null==e?t:o()(e).format({thousandSeparated:!0,...a})}(l)]}),(0,n.jsxs)("span",{className:"text-lg",children:["已使用: ",i(null==e?void 0:e.plan.usedStorageSize)]})]}),(0,n.jsx)("div",{className:"w-full bg-white rounded-2xl p-5  overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{className:"bg-indigo-50 rounded overflow-hidden text-black text-lg",children:O.map((e,t)=>(0,n.jsx)("th",{className:h()("p-3 font-bold whitespace-nowrap text-left",{"rounded-l":0===t,"rounded-r":t===O.length-1}),children:e},e))})}),(0,n.jsx)("tbody",{className:"text-black text-lg",children:null==d?void 0:d.map((e,t)=>{var a,l,s,r,o;let c=p(e);return(0,n.jsxs)("tr",{className:" cursor-pointer hover:bg-zinc-100 whitespace-nowrap",children:[(0,n.jsx)("td",{className:"p-3 rounded-l overflow-hidden",children:(0,n.jsx)(A,{text:e.name})}),(0,n.jsx)("td",{className:"p-3",children:(0,n.jsx)(A,{text:e.cid})}),(0,n.jsx)("td",{className:"p-3",children:i(e.fileSize)}),(0,n.jsx)("td",{className:"p-3",children:e.createTime}),(0,n.jsx)("td",{className:"p-3",children:(0,n.jsx)(A,{text:null===(a=e.meta)||void 0===a?void 0:a.reportCode})}),(0,n.jsx)("td",{className:"p-3",children:(0,n.jsx)(A,{text:null===(l=e.meta)||void 0===l?void 0:l.sampleType})}),(0,n.jsx)("td",{className:"p-3",children:(0,n.jsx)(A,{text:null===(s=e.meta)||void 0===s?void 0:s.customerCode})}),(0,n.jsx)("td",{className:"p-3",children:(0,n.jsx)(A,{text:null===(r=e.meta)||void 0===r?void 0:r.clinicCode})}),(0,n.jsxs)("td",{className:"p-3 flex items-center gap-2 rounded-r overflow-hidden",children:[(0,n.jsx)(R.C3L,{"data-tooltip-id":"tooltip","data-tooltip-content":"复制链接",className:"cursor-pointer",onClick:e=>{g(c)}}),(0,n.jsx)(R.AlO,{"data-tooltip-id":"tooltip","data-tooltip-content":"打开文件",className:"cursor-pointer",onClick:e=>{window.open(c,"_blank")}}),(0,n.jsx)(R.Ybf,{"data-tooltip-id":"tooltip","data-tooltip-content":"删除文件",className:"cursor-pointer",onClick:t=>{_(e.id)}}),(null===(o=e.meta)||void 0===o?void 0:o.password)&&(0,n.jsx)(R.jRj,{"data-tooltip-id":"tooltip","data-tooltip-content":"查看密码",className:"cursor-pointer",onClick:e=>{e.stopPropagation()}})]})]},"file_"+t)})})]})}),(0,n.jsx)(H,{className:"my-8",onPageChange:(e,t)=>{a(e)},total:l||0,pgSize:9,pgNum:t})]}),w&&(0,n.jsx)(M,{file:w,onClose:()=>j(void 0),onSuccess:()=>{x(),j(void 0)}}),N&&(0,n.jsx)(q,{file:N,onClose:()=>C(void 0)})]})}function Y(){let e=m(e=>e.logined);return(0,n.jsxs)("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto",suppressHydrationWarning:!0,children:[(0,n.jsx)("div",{className:"w-full z-10 h-16 bg-primary shrink-0 sticky top-0"}),(0,n.jsx)("div",{className:h()("flex-1 w-full items-center flex flex-col",{"bg-zinc-100":e}),children:e?(0,n.jsx)(B,{}):(0,n.jsx)(E,{})})]})}}}]);